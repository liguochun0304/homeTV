<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>用户中心 - homeTV</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
    <style>
        body { background: #141414; color: #fff; }
        .card { background: #1f1f1f; border: none; color: #fff; }
        .form-control { background: #333; border: none; color: #fff; }
        .form-control:focus { background: #444; color: #fff; box-shadow: none; }
        .btn-primary { background-color: #e50914; border: none; }
        .btn-primary:hover { background-color: #b20710; }
        .info-label { color: #999; font-size: 0.9em; margin-bottom: 2px; }
        .info-value { font-size: 1.1em; margin-bottom: 15px; font-weight: 500; }
        .invite-box { background: #000; padding: 15px; border-radius: 8px; text-align: center; border: 1px dashed #444; }
        .invite-code { font-size: 24px; letter-spacing: 2px; color: #e50914; font-weight: bold; }
    </style>
</head>
<body>

<div id="app" class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="fas fa-user-circle me-2"></i>用户中心</h3>
        <a href="/" class="btn btn-outline-light btn-sm"><i class="fas fa-home me-1"></i>返回首页</a>
    </div>

    <div v-if="loading" class="text-center py-5">
        <div class="spinner-border text-danger"></div>
    </div>

    <div v-else-if="user" class="row">
        <div class="col-md-6 mx-auto">
            <div class="card shadow-lg">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <div style="width:80px; height:80px; background:#e50914; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:32px; font-weight:bold;">
                            {{ user.username.charAt(0).toUpperCase() }}
                        </div>
                        <h4 class="mt-3">{{ user.username }}</h4>
                        <div class="badge bg-secondary">{{ user.role || '普通用户' }}</div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="info-label">注册时间</div>
                            <div class="info-value">{{ formatDate(user.createdAt) }}</div>
                        </div>
                        <div class="col-6">
                            <div class="info-label">推荐人</div>
                            <div class="info-value">{{ user.referrer || '-' }}</div>
                        </div>
                    </div>

                    <hr class="border-secondary my-4">

                    <h5 class="mb-3"><i class="fas fa-ticket-alt me-2 text-warning"></i>我的邀请码</h5>
                    <div class="invite-box mb-3">
                        <div class="invite-code">{{ user.inviteCode }}</div>
                        <div class="mt-2 text-muted small">分享此码给好友注册</div>
                    </div>
                    <button class="btn btn-outline-light w-100 mb-4" @click="copyInvite">
                        <i class="fas fa-copy me-2"></i>复制邀请码
                    </button>

                    <button class="btn btn-danger w-100" @click="logout">退出登录</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;
createApp({
    data() { return { user: null, loading: true }; },
    mounted() {
        const token = localStorage.getItem('hometv_token');
        if(!token) { window.location.href='/login.html'; return; }
        
        fetch('/api/v1/user/me', { headers: { 'Authorization': 'Bearer ' + token } })
            .then(res => {
                if(res.status === 401) { this.logout(); return; }
                return res.json();
            })
            .then(data => {
                this.user = data.data || data;
                this.loading = false;
            })
            .catch(() => this.logout());
    },
    methods: {
        formatDate(str) {
            if(!str) return '-';
            return new Date(str).toLocaleDateString();
        },
        logout() {
            localStorage.removeItem('hometv_token');
            window.location.href = '/login.html';
        },
        copyInvite() {
            if(!this.user) return;
            navigator.clipboard.writeText(this.user.inviteCode).then(() => {
                alert('邀请码已复制！');
            });
        }
    }
}).mount('#app');
</script>
</body>
</html>
